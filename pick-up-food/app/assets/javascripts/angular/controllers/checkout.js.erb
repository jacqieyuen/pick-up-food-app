app.controller('CheckoutCtrl', ['$scope', '$http', '$localStorage',function($scope, $http, $localStorage){
  $scope.message = "Checkout Page"

  $scope.checkoutList = $localStorage.checkoutList;
  console.log($scope.checkoutList);

  $scope.deleteItem = function($index){
    $scope.deletedItem = $scope.checkoutList.splice($index, 1);
    console.log("item that was deleted")
    console.log($scope.deletedItem)
    console.log("items left in checkoutList")
    console.log($scope.checkoutList)
  };

  $scope.createTimes = function () {
    $scope.array = [1,2,3,4]
    // [{name:1},{name:2},{name:3}]
  };
  $scope.createTimes();
  $scope.showSelectedTime = function () {
    console.log($scope.pickedTime);
  };

  $scope.checkoutTotal = function () {
    $scope.total = 0;
    for (var i = 0; i < $scope.checkoutList.length; i++){
      $scope.total += $scope.checkoutList[i].price
    }
    return $scope.total;
  }

  $http.get('http://localhost:3000/api/orders/get_client_token').success(function(response){
    $scope.clientToken = response.key
    // console.log($scope.clientToken);
    // console.log(($scope.total).toString());
    braintree.setup($scope.clientToken, 'dropin', {
      container: 'dropin-container',
      paymentMethodNonceReceived: function (event, nonce) {
      $scope.data = {
        amount: ($scope.total).toString(),
        payment_method_nonce: nonce
      };
      console.log(nonce)
      console.log(($scope.total).toString())
      $http.post('http://localhost:3000/api/orders', $scope.data).success(function(resp){
        console.log(resp)
      });
    }
    });
  });


}])