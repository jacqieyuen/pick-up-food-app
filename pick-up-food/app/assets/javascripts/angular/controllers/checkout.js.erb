app.controller('CheckoutCtrl', ['$scope', '$http', '$localStorage',function($scope, $http, $localStorage){
  $scope.message = "Checkout Page"

  $scope.checkoutList = $localStorage.checkoutList;
  console.log($scope.checkoutList);

  $scope.deleteItem = function($index){
    $scope.deletedItem = $scope.checkoutList.splice($index, 1);
    console.log("item that was deleted")
    console.log($scope.deletedItem)
    console.log("items left in checkoutList")
    console.log($scope.checkoutList)
  };



  $scope.checkoutTotal = function () {
    $scope.total = 0;
    for (var i = 0; i < $scope.checkoutList.length; i++){
      $scope.total += $scope.checkoutList[i].price
    }
    return $scope.total;
  }

  $http.get('http://localhost:3000/api/orders/get_client_token').success(function(response){
    $scope.clientToken = response.key
    // console.log($scope.clientToken);
    // console.log(($scope.total).toString());
    braintree.setup($scope.clientToken, 'dropin', {
      container: 'dropin-container',
      paymentMethodNonceReceived: function (event, nonce) {
      $scope.data = {
        amount: ($scope.total).toString(),
        payment_method_nonce: nonce
      };
      console.log(nonce)
      console.log(($scope.total).toString())
      $http.post('http://localhost:3000/api/orders', $scope.data).success(function(resp){
        console.log(resp)
      });
    }
    });
  });



  $scope.createTimes = function () {
    $scope.timesArray = []
    // [{name:1},{name:2},{name:3}]
    var flag = false;

    var currentTime = new Date();
    var currentHour = currentTime.getHours();
    var currentMinute = currentTime.getMinutes();
    function round5(x) {
    if (x<55){
    return Math.ceil(x/5)*5;
    }else{return 0}
    };

    function minutePlus15(x, currentHour){
      x = x + 15;
      if (x>55){
        x = x - 60;
        return {minute: round5(x), hour: (currentHour = currentHour+1)};
        ;
      }else{return {minute: x, hour: currentHour};}
    };
    var minuteRounded = (minutePlus15(round5(currentMinute), currentHour)).minute;

    currentHour = (minutePlus15(round5(currentMinute), currentHour)).hour;
    // console.log(minuteRounded)
    // console.log("this is the heehafhkj " +currentHour);

    function listOfTimes(){
      // if (minuteRounded = 0){
      //   flag = true
      // };
      if(currentHour>=6){
        for(currentHour; currentHour<=19; currentHour++){
          // console.log("the hour is "+currentHour);
          if(flag){
            minuteRounded=0;
          };
          for(minuteRounded; minuteRounded<=55; minuteRounded = minuteRounded+5){
            // console.log("running");
            var Minute = 0
            if (minuteRounded<=6){
              Minute = "0"+minuteRounded;
            }else{
              Minute = minuteRounded};
            var availableTime = currentHour+":"+Minute;
            // console.log("time available is "+currentHour+":"+Minute);
            $scope.timesArray.push(availableTime);
            flag = true;

          };
        };
      }
      // else{alert("We are open between 7am-9pm. You may start placing orders at 6am and last order is at 7:55pm")}
    }
    listOfTimes();
    console.log("generating times LOOOOOOOKLOOK!");
  };
  $scope.createTimes();
  $scope.showSelectedTime = function () {
    console.log($scope.pickedTime);
    // $scope.createTimes();

  };

///////////////////////////////////////////////////


}])